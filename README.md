# CaeTun

```
                      __
  ____ _____    _____/  |_ __ __  ____
_/ ___\\__  \ _/ __ \   __\  |  \/    \
\  \___ / __ \\  ___/|  | |  |  /   |  \
 \___  >____  /\___  >__| |____/|___|  /
     \/     \/     \/                \/

```

## Data Transmission

```
+----------------------------------------------------------------+          +----------------------------------------------------------------+
|                                                                |          |                                                                |
|  +--------------------+      +--------------------+            |          |                              +--------------------+            |  +----------------+
|  |     Web Browser    |      |       caetun       |<-----+     |          |                              |       caetun       |<-----+     |  | server 1.1.1.1 |
|  +--------------------+      +--------------------+      |     |          |                              +--------------------+      |     |  +----------------+
|             | 1                        | 5               |     |          |                                        | 13              |     |          |
|.............|..........................|.................|.....|          |........................................|.................|.....|          |
|             |                          |                 |     |          |                                        |                 |     |          |
|       +----------+               +----------+            |     |          |                                  +----------+            |     |          |
|       | socket A |               | socket B |            |     |          |                                  | socket C |            |     |          |
|       +----------+               +----------+            |     |          |                                  +----------+            |     |          |
|             | 2                        | 6               |     |          |                                        | 14              |     |          |
|.............|..........................|..... ...........|.....|          |........................................|.................|.....|          |
|             |                          |                 |     |          |                                        |                 |     |          |
|        +-------------------------------------+         4 |     |          |        +-------------------------------------+        12 |     |          | 17
|        |       Network Protocol Stack        |           |     |          |        |       Network Protocol Stack        |           |     |          |
|        +-------------------------------------+           |     |          |        +-------------------------------------+           |     |          |
|             | 7                        | 3               |     |          |             | 10   | 15                | 11              |     |          |
|.............|......................... |.................|.....|          |.............|......|...................|.................|.....|          |
|             |                          |                 |     |          |             |      |                   |                 |     |          |
|        +----------------+    +----------------+          |     |          |        +----------------+    +----------------+          |     |          |
|        | eth0 10.1.1.1  |    | tun0 10.8.0.1  |          |     |          |        | eth0 10.1.1.2  |    | tun0 10.8.0.2  |          |     |          |
|        +----------------+    +----------------+          |     |          |        +----------------+    +----------------+          |     |          |
|              |                         |                 |     |          |             | 9    | 16                |                 |     |          |
|              | 8                       +-----------------+     |          |             |      |                   +-----------------+     |          |
|              |                                                 |          |             |      |                                           |          |
+--------------|-------------------------------------------------+          +-------------|------|--------------------------------------------+         |
               |                                                                          |      |                                                      |
               +-------------------------------Physical Network---------------------------+      +-----------------Physical Network---------------------+
```


## Usage

![image](./assets/image.png)

### Build the image
```sh
docker build -t caetun .
```

### Create the network so we can control the IP addresses of containers
```sh
docker network create --subnet=172.18.0.0/16 net
```

### Run as server
```sh
docker run -d --cap-add=NET_ADMIN --device=/dev/net/tun --name caetun-server -e MODE=server --network net --ip 172.18.0.22 caetun
```

### Run client1
```sh
docker run -d --cap-add=NET_ADMIN --device=/dev/net/tun --name caetun-client1 -e MODE=client --network net caetun /etc/caetun/client1.conf
```

### Run client2
```sh
docker run -d --cap-add=NET_ADMIN --device=/dev/net/tun --name caetun-client2 -e MODE=client --network net caetun /etc/caetun/client2.conf
```